<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta charset="utf-8"><meta name="description" content=""><meta name="author" content="Stephan Peijnik"><title>Is trying to fix (E)SMTP really worth it? [part 1] | Stephan's blog</title><link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="../assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="../assets/css/rst.css" rel="stylesheet" type="text/css"><link href="../assets/css/code.css" rel="stylesheet" type="text/css"><link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="../assets/css/theme.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml"></head><body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>

            <a class="brand" href="../">
            Stephan's blog
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav"><li><a href="../archive.html">Archives</a>
            </li><li><a href="../categories/index.html">Tags</a>
            </li><li><a href="../rss.xml">RSS</a>

                </li></ul><ul class="nav pull-right"><li>
    <a href="#" id="sourcelink">Source</a>
    </li>

                </ul></div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
    <div class="postbox">
    
    <h1>Is trying to fix (E)SMTP really worth it? [part 1]</h1>

    <hr><small>
        Posted: <time class="published" datetime="2008-03-27T19:36:00+01:00">2008-03-27 19:36</time>
        

        
          |  More posts about
            <a class="tag" href="../categories/technology.html"><span class="badge badge-info">Technology</span></a>
            <a class="tag" href="../categories/observations.html"><span class="badge badge-info">observations</span></a>

    </small>
    <hr><p>[digg=http://digg.com/security/Is_trying_to_fix_E_SMTP_really_worth_it_part_1]<br>This one question has been in my mind for quite some time already. I mean, everyone uses <a href="http://en.wikipedia.org/wiki/SMTP">SMTP</a> (knowingly or not) when sending out emails and everyone sending emails also knows what <a href="http://en.wikipedia.org/wiki/E-mail_spam">SPAM</a> is and receives SPAM messages.<br><br>However, few know how old SMTP actually is, and that, even though it serves everyone well, it has been designed in a time when everyone was thinking of <a href="http://en.wikipedia.org/wiki/Spam_%28food%29">Spam</a> as canned meat. Back in 1982 SMTP was a great achievement and a lot of kudos should go to its creators, but now, in 2008, SMTP has become more of a liability than a great tool.<br><br>Originally, I wanted to write a single article covering all shortcomings of SMTP and possible solutions to these problems, but while writing the article a lot of text came up, so this is the first of two articles I am going to write on this topic. The first part is about the problems with SMTP and how fix-ups for SMTP are, even though they do work to some extent, a proper solutions to today's issues.<br><br>Due to the way SMTP was designed and the way the Internet was back then it is prone to various things, like SPAM messages, <a href="http://en.wikipedia.org/wiki/E-mail_spoofing">sender spoofing</a>, data manipulation and so forth. A few attempts have been made at fixing some of the shortcomings of SMTP, like <a href="http://en.wikipedia.org/wiki/SMTP-AUTH">ESMTPA</a> (SMTP-AUTH) or <a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a>, <a href="http://en.wikipedia.org/wiki/Callback_verification">Callback Verification</a>, and <a href="http://en.wikipedia.org/wiki/DKIM">DKIM</a>, but none of them has really fixed all problems that exist and all of these modifications are in my opinion mere workarounds.  Let us have a look at why both SPF and DKIM fail to fix the all problems SMTP has right now.<br><br><a name="more"></a><b>SPF</b><br><br>First let's have a quick look at how SPF works: When an email is received a special TXT DNS record at the sender's domain is used to verify that the sending computer (using its IP address) of an email is actually allowed to send email for a domain. A great mechanism that in theory would work perfectly well. Reality is a bit different though.<br><br>There are some domains which are actually using SPF and do have valid SPF records on their DNS servers. However, those are only some of the millions of domains on the Internet. How should one treat emails coming from a domain without SPF record? The messages could be real, non-SPAM messages, that should be delivered, but on the other hand these could be SPAM messages. Also, the more people start using SPF, the more likely it becomes that spammers are simply going to use sender-domains which do not have SPF records.<br>Also, there are some organizations that have domains with improperly configured SPF records and there are even well-known ones, such as <a href="http://www.technorati.com/">Technorati</a> (I covered this in <a href="http://blog.sp.or.at/2008/03/25/mails-from-technorati-not-arriving-not-obeying-their-own-spf-rules/">one of my articles</a>). So one cannot even trust SPF records and valuable messages could be lost if a mail server is configured to drop all messages for which SPF authentication fails.<br><br>And there is a third problem: Sending emails from other places than your default one (office, home, etc.) and ISPs not allowing external users to use their SMTP servers (even not with authentication). A good example of this would be Austrian ISP <a href="http://www.upc.at/">UPC</a> (their SMTP server tells me that the AUTH extension was not advertised, even though it was; long story short, I cannot log in from outside) and I am quite sure there are a lot of others.<br><br>And I can come up with yet another problem: What about email relaying? Think about downloading all messages from all your email accounts into a single one, using <a href="http://fetchmail.berlios.de/">fetchmail</a> for example. This makes SPF useless, as no checks can be done anymore, due to the sending system's IP address not being the original sender. If one assumes that every mail server uses SPF this is not a problem, but I like doing my checks on my server rather than relying on some other server.<br><br>Maybe there are even more problems with SPF, such as what to do when an email is received from a <a href="http://www.ops.ietf.org/lists/namedroppers/namedroppers.2005/msg00053.html">nonexistant domain</a> or when there is a temporary DNS failure on either side, but the ones listed above are those I am confronted with most often.<br><br><b>Callback Verification</b><br><br>On to the next topic. Callback verification is a simple method used by mail servers to try verifying that the sender actually exists. Whilst this works for some SPAM messages which use non-existent senders,  it does not help much as soon as the sender address does exist, and it does not even matter if the message was actually sent by the user owning the address. I guess there is nothing to add, even though it is a nice method to get rid of some spam it does not help with a lot of such messages.<br><br><b>DKIM</b><br><br>DKIM, or DomainKeys Identified Mail (originally named DomainKeys) is a method that is not meant to prevent abuse (such as SPAM), but rather to make tracking abuse easier. It works by the sender (usually the MSA of the sender on behalf of him) adding another header, "DKIM-Signature", which contains a cryptographic signature of the message body.  The signature is generated using <a href="http://en.wikipedia.org/wiki/Public-key_cryptography">public-key cryptography</a>, where the public key is stored in a DNS TXT record and can thus be used by the receiving end to verify that the message contents have not been tampered with during transport and that the mail actually originated from that domain.<br><br>This method, even though being one of the most advanced ones today, is prone to replay attacks and does not protect from tampering with message headers. In short this means that even though the message body cannot be modified without the receiving end detecting the modification, the headers can, and thus the message can be redirected. Also, it is possible to intercept the transmission of a message, generate a thousand messages with the same content but a different recipient and this way flood a mailbox with a message that would stand DKIM verification.<br><br>The email relaying problem that's present in SPF is not a problem here anymore, but the mobile-mail, the nonexistent domain and the DKIM-not-in-use problem still exist.<br>Also, DKIM seems not to be used by a lot of email servers on the Internet. Thinking about it for a second I can just come up with two names of well-known organizations using DKIM: Google and Yahoo.<br><br><b>The message format</b><br><br>The next part of this article is about the SMTP message format. This part is not directly related to the SPAM problem, but should provide you with some more information that verifies that SMTP is outdated nowadays.<br><br><a href="http://en.wikipedia.org/wiki/Email#Format">RFC822 messages</a> (or emails) usually consist of two parts: a message header and a message body. Originally these messages were designed to contain 7bit-encoded ASCII data, which is plain text. This means that there were only 128 different characters which could be transferred via email, without support of special characters, like German "Umlaut" characters. A solution has then be developed, not only to support special characters in emails, but also to support transferring of binary data (such as images).<br><br><a href="http://en.wikipedia.org/wiki/MIME">MIME</a> is the name of this solution, and it enables every one of us to send binary attachments and special characters via email today. MIME allows the email client to include more than just 7-bit plain text messages, including attachments. This is achieved by special header, "<i>MIME-Version</i>", which indicates that the contents of a message are MIME encoded. This header is then followed by a "<i>Content-Type</i>" header, identifying the type of content. For simple messages just consisting of a message body this would be "text/plain", telling the client that there is just text in the mail.<br><br>However, how can emails then consist of both text and attachments? Well, there is a special value for the "Content-Type" header: "<i>multipart/mixed</i>". This one indicates that there are several parts of a message, and every part comes with a separate "<i>Content-Type</i>" header. This way contents of a message can be organized in a tree, for example, containing the message body and a forwarded message.<br><br>An attachment is added by specifying an additional part of the message, usually with a "<i>Content-Transfer-Encoding: base64</i>" header, that says that the data has been <a href="http://en.wikipedia.org/wiki/Base64">base64</a> encoded. This way binary data can be represented using 7-bit ASCII.<br><br>But what does that mean? First of all, even though a message is split into several parts, there is only one body. Now if you are downloading a message via POP3 for example, there is no way of only downloading the actual text. You always need to download the whole message. Everyone knows this situation: You are downloading a message and have to wait for all attachments to be downloaded, even though you might not be interested in those attachments at all.<br><br>Also, encoding binary data using base64 creates a lot of overhead, as every byte (which can have 256 different values and corresponds to a single letter of text in 7-bit ASCII) is represented using only 64 possible values. Talking numbers here this means that messages encoded using base64 are usually 137% the size of the data they contain.<br><br><b>Conclusion</b><br><br>I hope that I have shown you what the problems with SMTP are right now. SMTP initially was  designed to transport only text and had no way of verifying either the sender of a message or the integrity of data. Some workarounds have been created to get rid of these issues, but even though some helped a lot, none has really fixed any of those problems.<br><br>Also, one should never forget how much time and money has been used to try fixing SMTP, whilst a lot less money might have been sufficient for creating something new, something better, something that is built for the needs of the Internet today, and not for the needs of the Internet back in 1982.<br><br>Personally I believe that the days of SMTP are long over and that there is need of a proper replacement. I do understand that SMTP and the current email infrastructure are still in use because an infrastructure exists, but SMTP really deserves being retired, after serving us pretty well for more than 25 years.<br><br>The next part in this series of articles will be about what my idea of a successor of SMTP and the whole email infrastructure is, what it could look like and also how it could work. So stay tuned.</p>
    
    <ul class="pager"><li class="previous">
            <a href="200803how-to-reject-mails-containing-ooxml.html">← Previous post</a>
        </li>
        <li class="next">
            <a href="200803free-software-supporter.html">Next post →</a>
        </li>
    </ul><div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname ="speijnikblog";
            var disqus_url="http://blog.sp.or.at/posts/200803is-trying-to-fix-esmtp-really-worth-it.html";
        var disqus_title="Is trying to fix (E)SMTP really worth it? [part 1]";
        var disqus_identifier="cache/posts/200803is-trying-to-fix-esmtp-really-worth-it.html";
        var disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    

    </div>

    </div>
    </div>
    <!--End of body content-->
</div>
<div class="footerbox">
    Contents © 2013         <a href="mailto:stephan@peijnik.at">Stephan Peijnik</a> - Powered by         <a href="http://nikola.ralsina.com.ar">Nikola</a>
</div>

    <!-- Social buttons -->
    <div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
    <a class="addthis_button_more">Share</a>
    <ul><li><a class="addthis_button_facebook"></a>
    </li><li><a class="addthis_button_google_plusone_share"></a>
    </li><li><a class="addthis_button_linkedin"></a>
    </li><li><a class="addthis_button_twitter"></a>
    </li></ul></div>
    <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script><!-- End of social buttons --><script src="../assets/js/jquery-1.7.2.min.js" type="text/javascript"></script><script src="../assets/js/bootstrap.min.js" type="text/javascript"></script><script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script><script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script></body></html>