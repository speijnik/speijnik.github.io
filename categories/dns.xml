<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>Stephan's blog (DNS)</title><link>http://blog.sp.or.at</link><description>Stephan's notes on technology</description><lastBuildDate>Wed, 22 May 2013 18:25:16 GMT</lastBuildDate><generator>nikola</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>How to force a local DNS resolver to be used using resolvconf</title><link>http://blog.sp.or.at/posts/201106how-to-force-local-dns-resolver-to-be.html</link><description>&lt;p&gt;I know it has been a while, but after reading a &lt;a href="http://www.progsoc.org/~wildfire/aum/2011/06/01#bind2"&gt;blog post&lt;/a&gt; by Anand Kumria over at &lt;a href="http://planet.debian.org/"&gt;planet.debian.org&lt;/a&gt; I decided to have a quick look at one of the problems he described.&lt;br&gt;&lt;br&gt;Basically, Anand wants to force the local resolver to be used for each and every network connection, may that connection be established manually or via NetworkManager. He wrote that fixing this configuration for every new connection manually is tedious, and I fully agree on that. So here is a solution to do this all automatically, using &lt;i&gt;resolvconf&lt;/i&gt;:&lt;br&gt;&lt;br&gt;After installing the &lt;i&gt;resolvconf&lt;/i&gt; package every time &lt;i&gt;/etc/resolv.conf&lt;/i&gt; is to be updated &lt;i&gt;resolvconf&lt;/i&gt; takes care of that. Using the files in &lt;i&gt;/etc/resolvconf&lt;/i&gt; this process can be controlled and the resulting file modified to fit one own's needs.&lt;br&gt;&lt;br&gt;So at first we would like the local resolver to be used for every connection. This works by simply adding the "nameserver 127.0.0.1" directive to the &lt;i&gt;/etc/resolvconf/resolv.conf.d/head&lt;/i&gt; file. Simple as that. Every time &lt;i&gt;/etc/resolv.conf&lt;/i&gt; gets generated the contents of the head file are actually used as &lt;i&gt;/etc/resolv.conf&lt;/i&gt;'s header.&lt;br&gt;&lt;br&gt;Using this method the local resolver is used for every connection. But Anand wanted to use &lt;b&gt;only&lt;/b&gt; the local resolver and discard any resolvers possibly obtained via DHCP for example. Guess what, this is also possible using resolvconf.&lt;br&gt;&lt;br&gt;Adding &lt;i&gt;TRUNCATE_NAMESERVER_LIST_AFTER_127="yes"&lt;/i&gt; to &lt;i&gt;/etc/default/resolvconf&lt;/i&gt; does exactly that. Now every &lt;i&gt;nameserver&lt;/i&gt; directive after the 127.0.0.1 one is ignored and will not make it into /&lt;i&gt;etc/resolv.conf&lt;/i&gt;. You can of course add more nameservers to the &lt;i&gt;head&lt;/i&gt; file above the 127.0.0.1 directive.&lt;br&gt;&lt;br&gt;Problem fixed I guess.&lt;br&gt;Don't forget to re-connect to the network or manually force re-creation of &lt;i&gt;/etc/resolv.conf&lt;/i&gt; so the changes you made get populated. I really hope this is of use to some of you facing similar problems.&lt;/p&gt;</description><category>DNS</category><category>Debian</category><category>NetworkManager</category><category>GNU/Linux</category><category>Networking</category><guid>http://blog.sp.or.at/posts/201106how-to-force-local-dns-resolver-to-be.html</guid><pubDate>Wed, 01 Jun 2011 18:53:00 GMT</pubDate></item></channel></rss>