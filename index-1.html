<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="description" content="Stephan's notes on technology"><meta name="author" content="Stephan Peijnik"><title>Stephan's blog (old posts page 1) | Stephan's blog</title><link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="assets/css/rst.css" rel="stylesheet" type="text/css"><link href="assets/css/code.css" rel="stylesheet" type="text/css"><link href="assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="assets/css/theme.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS (en)" href="rss.xml"><meta http-equiv="expires" content="600"></head><body class="home blog">
    <script type="text/javascript">var addthis_config={"ui_language":"en"};</script><div id="wrap" style="width:850px">
        <div id="container" style="width:560px">
            
        <div class="postbox">
        <h1><a href="posts/200911kvm-qemu-and-magic-of-ubuntu-vm-builder.html">kvm, qemu and the magic of ubuntu-vm-builder</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-11-11 08:25
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/technology.html"><span class="badge badge-info">Technology</span></a>
                            <a class="tag" href="categories/android.html"><span class="badge badge-info">Android</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                            <a class="tag" href="categories/ubuntu.html"><span class="badge badge-info">Ubuntu</span></a>
                </span>
            </div>
        <p>As I <a href="http://techandsp.blogspot.com/2009/11/my-android-repositories.html">noted</a> two days ago I was unable to build Android on Ubuntu 9.10 x86-64 and thus needed to set up a virtual machine.<br><br>At first I went for my preferred virtualization solution, <a href="http://www.virtualbox.org/">VirtualBox</a> and had to notice that even though I assigned all 4 processor cores of my workstation (along with 2GiB of memory) to the virtual machine building was painfully slow. I immediately ditched the idea of using  VirtualBox again and decided to give something new to me a try: the combination of <a href="http://www.linux-kvm.org/page/Main_Page">kvm</a> and <a href="http://www.qemu.org/">qemu</a>.<br><br>Having Intel VT-x support built into my workstation's processor I thought that this combination should give better performance, and I wasn't disappointed. To be honest, I am astonished on how fast the beast is now. Disk speed still seems to be not as fast as running things natively, but there must be a downside somewhere. :-)<br><br>After a bit of googling I also found that <a href="https://launchpad.net/vmbuilder">ubuntu-vm-builder</a> exists, which simplifies virtual system creation tremendously.<br><br>My Android working tree is being synchronized right now, which means that I should be able to start building in a few minutes time. I hope the virtual machine stays as fast as it is right now during the build and I hope everything goes well.</p>
            
    <p>
        <a href="posts/200911kvm-qemu-and-magic-of-ubuntu-vm-builder.html#disqus_thread" data-disqus-identifier="cache/posts/200911kvm-qemu-and-magic-of-ubuntu-vm-builder.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200911update-on-proprietary-maemo-sdk.html">An update on the proprietary Maemo SDK installer</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-11-09 21:00
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/technology.html"><span class="badge badge-info">Technology</span></a>
                            <a class="tag" href="categories/maemo.html"><span class="badge badge-info">Maemo</span></a>
                            <a class="tag" href="categories/android.html"><span class="badge badge-info">Android</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>Yesterday I <a href="http://techandsp.blogspot.com/2009/11/android-mythbusters-and-openness.html">wrote</a> about my dissatisfaction with the current state of the Android 2.0 code tree and how a proprietary install script for Maemo scared me off.<br><br>As suggested in one of the comments to my post I filed a bug report against Maemo, <a href="https://bugs.maemo.org/show_bug.cgi?id=6087">bug 6087</a>.<br><br>Besides getting quite a few replies to the bug report within a matter of hours Carsten Munk pointed me at <a href="http://maemo-sdk.garage.maemo.org/install.html">Maemo SDK+</a>, which has less restrictive licensing.<br><br>Another comment, by Marius Gedminas (thanks!) pointed me at <a href="http://wiki.maemo.org/Mer/About">Mer</a>,<br></p><blockquote>a new operating system for small, mobile touch-screen devices. <p>It is Linux based and layers the best open-source elements of Nokia's Maemo platform over a modern Ubuntu base. </p><p>The goals of Mer include: </p> <ul><li> Integrate the best solutions for a wide variety of small form-factor devices </li><li> Encourage wider access to device capabilities through the <a href="http://wiki.maemo.org/Mer/Documentation/Vendor_Social_Contract" title="Mer/Documentation/Vendor Social Contract">Vendor Social Contract</a> </li><li> Demonstrably provide an easy route to market for vendors </li><li> Dramatically reduce costs to vendors of supporting EOL hardware </li><li> Focus, harness and support community contributions to the platform </li><li> Encourage and ease migration of existing applications </li><li> Support experimentation, innovation and development </li></ul></blockquote><br><blockquote></blockquote>
            
    <p>
        <a href="posts/200911update-on-proprietary-maemo-sdk.html#disqus_thread" data-disqus-identifier="cache/posts/200911update-on-proprietary-maemo-sdk.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200911my-android-repositories.html">My Android repositories</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-11-09 20:58
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/technology.html"><span class="badge badge-info">Technology</span></a>
                            <a class="tag" href="categories/android.html"><span class="badge badge-info">Android</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>As I wrote in <a href="http://techandsp.blogspot.com/2009/11/android-roaming-detection-its.html">my last post</a> I noticed a few problems with Android's roaming detection code and decided to try fixing it myself.<br><br>So, I am basing my work on <a href="http://www.cyanogenmod.com/">CyanogenMod</a>, which I am also using on my Android device. My repositories are hosted at <a href="http://github.com/speijnik">github.com/speijnik</a> and you can fetch (nearly) everything you need for building by using <a href="http://source.android.com/download/using-repo">repo</a>. See the <a href="http://github.com/speijnik/android/blob/donut/README">README</a> file in my android repository over at github for details.<br><br>For now only the simplification of the roaming detection code has made it into the repository, but be aware that even though I have published the code I still have neither built nor tried it, as I do not have a working build environment set up yet.<br><br>Oh, about the working build environment: there seem to be problems with either the webkit code in the Android repositories (unlikely) or with building that code on Ubuntu 9.10 x86-64 (more likely). Right now I am downloading Ubuntu 8.04 LTS i386 for use in a virtual machine. I will let you know whether that fixes my problems or not.</p>
            
    <p>
        <a href="posts/200911my-android-repositories.html#disqus_thread" data-disqus-identifier="cache/posts/200911my-android-repositories.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200911android-roaming-detection-its.html">Android's roaming detection &amp; its implementation</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-11-08 20:04
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/foss.html"><span class="badge badge-info">foss</span></a>
                            <a class="tag" href="categories/technology.html"><span class="badge badge-info">Technology</span></a>
                            <a class="tag" href="categories/gsoc.html"><span class="badge badge-info">gsoc</span></a>
                            <a class="tag" href="categories/debian.html"><span class="badge badge-info">Debian</span></a>
                            <a class="tag" href="categories/android.html"><span class="badge badge-info">Android</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>I know I wrote about Android already today, but there is another thing that concerns me right now. I am owner of an Android-based phone (an HTC Dream) and recently switched my mobile network provider. The problem is that my new provider is a <a href="http://en.wikipedia.org/wiki/Mobile_Virtual_Network_Operator">virtual provider</a> and as such there is no real network of that provider. Now Android has a feature to turn off broadband connections when in roaming mode, which itself is a great idea and can save you from paying quite a lot of money when the phone connects to 3G abroad, but this feature also turns off broadband connections when roaming locally. All this is being discussed in bug report <a href="http://code.google.com/p/android/issues/detail?id=3499">#3499</a>.<br><br>After noticing this problem I became curious on how Android detects that it is roaming and I found the GsmServiceStateTracker.isRoamingBetweenOperators method to be responsible for that magic, but soon noticed that the method is not only inefficient, but also doesn't work as intended. This is hardly related to the bug mentioned above, but let's have a look at the code in question:<br></p><pre class="java" name="code">/**<br>* Set roaming state when gsmRoaming is true and, if operator mcc is the<br>* same as sim mcc, ons is different from spn<br>* @param gsmRoaming TS 27.007 7.2 CREG registered roaming<br>* @param s ServiceState hold current ons<br>* @return true for roaming state set<br>*/<br>    private<br>    boolean isRoamingBetweenOperators(boolean gsmRoaming, ServiceState s) {<br>        String spn = SystemProperties.get(PROPERTY_ICC_OPERATOR_ALPHA, "empty");<br><br>        String onsl = s.getOperatorAlphaLong();<br>        String onss = s.getOperatorAlphaShort();<br><br>        boolean equalsOnsl = onsl != null &amp;&amp; spn.equals(onsl);<br>        boolean equalsOnss = onss != null &amp;&amp; spn.equals(onss);<br><br>        String simNumeric = SystemProperties.get(PROPERTY_ICC_OPERATOR_NUMERIC, "");<br>        String operatorNumeric = s.getOperatorNumeric();<br><br>        boolean equalsMcc = true;<br>        try {<br>            equalsMcc = simNumeric.substring(0, 3).<br>                    equals(operatorNumeric.substring(0, 3));<br>        } catch (Exception e){<br>        }<br><br>        return gsmRoaming &amp;&amp; !(equalsMcc &amp;&amp; (equalsOnsl || equalsOnss));<br>    }</pre><br>Okay, let me summarize what this piece of code does wrong, at least from my understanding:<br><ul><br><li>It takes both the network operator alphanumeric identifier and alphanumeric long identifier and compares both to the alphanumeric identifier coming from the SIM card, whilst...</li><br><li>... it could simply use the network and SIM card numeric identifiers and compare those, which should be a lot cheaper than comparing those strings</li><br><li>Then it takes the first three characters/digits of the numeric identifiers (which indicate the country) and compares those</li><br></ul><br>Now in my case my SIM card doesn't seem to provide the phone with a alphanumeric identifier, so the first two comparisons always fail for obvious reasons and, looking at the inline-if in the last line of that method my phone will always indicate that I am in roaming mode, even when I am not.<br><br>The problem is not only the logic which seems to be wrong, but I rather see the inefficient comparisons used there to be a major problem in embedded systems like mobile phones. This is the first piece of Android code I have had a look at, but if all other code is as ugly and inefficient as these few lines Android really needs some major fixes. Related to this I have reported bug <a href="http://code.google.com/p/android/issues/detail?id=4590">#4590</a> and forked the <a href="http://github.com/speijnik/android_frameworks_base">git repository in question</a> over at github, to fix this method, should be a matter of 5 minutes.
            
    <p>
        <a href="posts/200911android-roaming-detection-its.html#disqus_thread" data-disqus-identifier="cache/posts/200911android-roaming-detection-its.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200911android-mythbusters-and-openness.html">Android, Mythbusters and openness</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-11-08 04:49
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/foss.html"><span class="badge badge-info">foss</span></a>
                            <a class="tag" href="categories/technology.html"><span class="badge badge-info">Technology</span></a>
                            <a class="tag" href="categories/personal.html"><span class="badge badge-info">personal</span></a>
                            <a class="tag" href="categories/gsoc.html"><span class="badge badge-info">gsoc</span></a>
                            <a class="tag" href="categories/debian.html"><span class="badge badge-info">Debian</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>I have been reading a great many posts about Android lately, some consisting of criticism, some of praise and some simply addressing issues in the Android "community". Let's have a look at those.<br><br><strong>Matt Porter's </strong><strong>Android Mythbusters presentation</strong><strong> and Harald Welte's reaction<br></strong><br><br>I haven't seen the presentation live, but I had a look at <a href="http://tree.celinuxforum.org/CelfPubWiki/ELCEurope2009Presentations?action=AttachFile&amp;do=get&amp;target=Mythbusters_Android.pdf" title="Mythbusters_Android.pdf @ tree.celinux.org">the slides</a>. Impressing work done by Matt putting all this information together. However, we all knew that Android only (ab-)uses Linux, without making use of the GNU userland for a long time, didn't we?<br><br>In his presentation Matt has shown things such as Android's udev "replacement" that uses hardcoded values for device node creation and (on his <a href="http://laforge.gnumonks.org/weblog/2009/11/04/#20091104-android_mythbusters" title="Android Mythbusters (Matt Porter) comment @ laforge.gnumonks.org">blog</a>) Harald has then come up with a statement I have found to be very strong:<br></p><blockquote>The presentation shows how Google has simply thrown 5-10 years of Linux userspace evolution into the trashcan and re-implemented it partially for no reason.  Things like hard-coded device lists/permissions in object code rather than config files, the lack of support for hot-plugging devices (udev), the lack of kernel headers.  A libc that throws away System V IPC that every unix/Linux software developer takes for granted. The lack of complete POSIX threads.  I could continue this list, but hey, you should read those slides. now!</blockquote><br>Now both of these statements target technical details, but the root of the problem seems to be elsewhere.<br><br><strong>Where is my Android 2.0?</strong><br><br>Okay, that heading might not be making any sense in the context of this post at a first glance, but let me elaborate on that. Google and the Open Handset Alliance refer to Android as being an "Open Source" operating system, but the project is different from "real" Free Software projects: development takes place in a closed group and the results are shared with the community later on, when they are deemed to be ready.<br><br>This means that innovation also takes place behind closed curtains and that the community is not involved in the actual development process at all. Lately we have seen the result of that, as Motorola is bragging about working close with Google on Android 2.0 ("Eclair"), but the AOSP source trees, open for everyone to have a look at, show no signs of version 2.0. In fact no changes that might even remotely suggest the release of a new major version have been made public in the past few weeks. So where is the openess there?<br>Actually, the Motorola Droid has already shipped with Eclair on 6th, but still, there is no indication that Eclair will be made available to the broader public.<br><br>In short Android seems to be developed behind closed curtains, with hardly (read no) community input whatsoever and is sometimes released as Free Software, not what I would describe as an open development process.<br><br><strong>The Android Market problem</strong><br><br>As we have seen in the past Google is enforcing their copyright on proprietary applications that ship with pretty much every Android device, such as the Android Market. This has become really clear when Steve Kondik received  a cease and desist letter when packing the Google-proprietary applications into his ROMs. Okay, it's Google's right to enforce their copyright and there is nothing wrong with actually doing so, the thing I really have a problem with is something else: the Market is proprietary.<br><br>Now what this means should become rather clear. You can have an Android device without Google's proprietary bits, but with default settings you just do not have any way of installing additional software. In my opinion the Market should be freed by Google themselves, or the community has to react and come up with a free replacement to overcome the vendor lock-in. Oh, you might know a replacement called <a href="http://www.slideme.org">SlideMe</a> (or Mobentoo) already. Well, that bugger is proprietary too, so not a solution at all.<br><br><strong>Nokia and Maemo to the rescue</strong><br><br>In most discussions about the openness of Android someone throws in Nokia and <a href="http://www.maemo.org">Maemo</a>, as a solution to the dilemma. Reading all those positive comments I simply had to give it a try, but all my hopes were destroyed within a few minutes.<br><br>Let's start with the good news and let alone the reason why my hopes were destroyed for another minute or two. Maemo is based on Debian GNU/Linux and various Free Software components, such as GTK+, gstreamer, esd and friends. Most of the system is Free Software which is a good thing(tm) and reading all of this really got me into Maemo. Okay, some applications seem to be proprietary, but I am sure that could be fixed rather easily, so I could once for all use a truly open phone.<br><br>...and then came the <a href="http://repository.maemo.org/stable/fremantle/maemo-sdk-install_5.0.sh">SDK installer shell script</a>:<br><blockquote>#!/bin/sh<br># Copyright (C) 2006-2009 Nokia Corporation<br>#<br># This is proprietary software owned by Nokia Corporation.<br>#<br># Contact: Maemo Integration &lt;integration@maemo.org&gt;<br># Version: $Revision: 1110 $</blockquote><br>Now there is one question you should ask yourself: Why would someone trying to promote his platform as being open make the *installer* script for its SDK proprietary? Come on, it's an installer script, how much of your secret juice could be in there? What's the problem with people modifying it and working on this installer script in an open development environment?<br><br>I had high hopes for Nokia actually doing a bit better than Google, but it seems they've failed to do so. It may be me overreacting, but a proprietary SDK installer shell script scares me enough not to install the SDK and have a look at it for now nor to think about buying a Maemo-based device in the near future. Please Nokia, either get the facts straight or provide us with a free SDK to your free &amp; open platform.<br><br>So, in short, Google is bad at working with the community and creating a truly open development process, and Nokia simply fails in terms of not scaring off prospective developers for their open platform with the proprietary SDK installer. Do you have any solutions in terms of an open phone environment, apart from what OpenMoko has come up with?
            
    <p>
        <a href="posts/200911android-mythbusters-and-openness.html#disqus_thread" data-disqus-identifier="cache/posts/200911android-mythbusters-and-openness.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200911how-to-move-panels-in-gnome-228.html">How to move panels in Gnome 2.28</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-11-04 10:04
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/foss.html"><span class="badge badge-info">foss</span></a>
                            <a class="tag" href="categories/technology.html"><span class="badge badge-info">Technology</span></a>
                            <a class="tag" href="categories/gsoc.html"><span class="badge badge-info">gsoc</span></a>
                            <a class="tag" href="categories/observations.html"><span class="badge badge-info">observations</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>I just installed Ubuntu Karmic Koala on my workstation and came across the problem of not being able to move/drag Gnome panels around in order to have the panels on my primary monitor.<br>On the Debian system that was powering the workstation before this was a non-issue as I could simply click, hold and drag both the upper and the lower panel, but this didn't work.<br><br>So, after a few minutes of googling I came across an entry at answers.launchpad.net[0] and a blog post, but I cannot seem to remember the URL to that one. I can imagine that some of you might be having the exact same problem, so the solution is holding down the ALT, whilst dragging as usual.<br><br>[0] <a href="https://answers.launchpad.net/ubuntu/+source/gnome-panel/+question/264">https://answers.launchpad.net/ubuntu/+source/gnome-panel/+question/264</a></p>
            
    <p>
        <a href="posts/200911how-to-move-panels-in-gnome-228.html#disqus_thread" data-disqus-identifier="cache/posts/200911how-to-move-panels-in-gnome-228.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200908automagic-bug-reporting-in-python.html">Automagic bug reporting in Python applications for Debian</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-08-17 20:23
                </span>
                <br><span class="tags">Tags: 
                </span>
            </div>
        <p>We all know this situation: a program crashes and you need to send a bug report to the DBTS. The damn bug however is hard to reproduce and you fail to do so and hence can't submit the report.<br><br>This has all changed for update-manager now. With the next upload to unstable update-manager will get automagic bug reporting. In short: there is code that detects uncaught exceptions, asks the user if he or she wants to file a bug report and then invokes reportbug. Nothing too special about this yet. There is one thing that should make lives of both bug reporters and developers easier though: the code automatically includes traceback information, that make finding the cause of the problem a lot easier.<br><br>Okay, enough of praising this feature of update-manager, this post is about something else. Ubuntu users and developers might think "apport" now, because apport is an application that provides exactly this, reporting of bugs on program crashes, for all users.<br><br>At least for Python applications and libraries in Debian providing this functionality should be easy. The only thing one has to do is create a sys.excepthook implementation that does the bug reporting, just as in update-manager.<br><br>The questions I have now are:<br><br>Do you think this feature would be a good addition to the Debian distribution?</p>
            
    <p>
        <a href="posts/200908automagic-bug-reporting-in-python.html#disqus_thread" data-disqus-identifier="cache/posts/200908automagic-bug-reporting-in-python.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200907update-manager-weekly-update-6.html">update-manager weekly update #6</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-07-09 19:07
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/gsoc.html"><span class="badge badge-info">gsoc</span></a>
                            <a class="tag" href="categories/python.html"><span class="badge badge-info">python</span></a>
                            <a class="tag" href="categories/debian.html"><span class="badge badge-info">Debian</span></a>
                            <a class="tag" href="categories/update-manager.html"><span class="badge badge-info">update-manager</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>So finally I have the time to provide you with a weekly update, instead of my usual bi-weekly ones.<br><br>Unfortunately I did not work on anything on last week's TODO list, but found other issues I worked on and corrected.  So let's have a look at what I've done.<br><br><strong>Debian packaging update</strong><br><br>I have done some work on the Debian packaging, which allows update-manager to be built using dpkg-buildpackage now. The way packages are splitted is not finalized yet and not up-to-date with my (and my mentor's) idea of how we should do that. You can expect an update to that soonish.<br><br><strong>Automatically invoking package list reloading / update check</strong><br><br>There is a command line switch (namely -c, or --check) now, that automatically performs an update check on startup. This gives other programs, like software-properties, a way of forcing a check when, for example, the package list sources have changed.<br><br><strong>Checking/unchecking all updates in Gtk frontend</strong><br><br>Finally the small feature of selecting or deselecting all updates works in the Gtk frontend. Special cases like "all updates already checked" or "no updates checked" yet are handled too, meaning that you can only use one of these methods if it actually makes sense.<br><br><strong>Package dependencies in python-apt backend and Gtk frontend</strong><br><br>Both the python-apt backend and the Gtk frontend are now aware of package dependencies. This means that when you select an upgrade that depends on another one that other update is selected too. The same works vice-versa too. Additionally the UI now lists all dependencies and dependencies on packages that are not installed yet and automatically deselects all updates that would requires new packages to be installed.<br><br><strong>Displaying of overall download size in Gtk frontend</strong><br><br>There has been a missing feature (ok, maybe a bug) so that the displayed download size would not be updated in the Gtk frontend. This has been fixed.<br><br><strong>Install button being set sensitive correctly in Gtk frontend</strong><br><br>In the past the install button would be set to either sensitive or insensitive at startup and not updated afterwards. That means if there were no packages to update when starting update-manager, then checking for updates where new updates are found, the install button would not be set sensitive again. I fixed that too.<br><br><strong>Sorting of packages in Gtk frontend</strong><br><br>In the Gtk frontend packages were not sorted at all, which meant that finding a specific package was rather hard. I added code that sorts the update list by package name now, which solves this issue.<br><br><strong>Bugfixing humanize_size</strong><br><br>The humanize_size method, which is responsible for human-readable size displaying in the Gtk frontend contained a major bug so that sizes were rounded. Again, I was able to solve this.<br><br><strong>Next week's TODO list</strong><br><br>As I didn't find time to work on last week's TODO list my new TODO list is in fact my old one, with additional "Bugfixing" and "Debian packaging" tasks:<br></p><ul><br><li>Downloading and installing of updates</li><br><li>Bugfixing (?)</li><br><li>Debian packaging</li><br><li>Checking that everything is documented</li><br><li>Even more unit tests</li><br><li>Pylint checking</li><br><li>If time permits and everything else works correctly: working on an aptdaemon backend</li><br></ul><br>The next thing you can expect me to update is the Debian packaging and the documentation, which are my highest priority tasks for now, followed by support for downloading and installing updates.<br><br>Happy hacking!
            
    <p>
        <a href="posts/200907update-manager-weekly-update-6.html#disqus_thread" data-disqus-identifier="cache/posts/200907update-manager-weekly-update-6.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200907update-manager-weekly-update-5.html">update-manager weekly update #5</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-07-02 11:29
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/gsoc.html"><span class="badge badge-info">gsoc</span></a>
                            <a class="tag" href="categories/python.html"><span class="badge badge-info">python</span></a>
                            <a class="tag" href="categories/debian.html"><span class="badge badge-info">Debian</span></a>
                            <a class="tag" href="categories/update-manager.html"><span class="badge badge-info">update-manager</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>Firstly I have to apologize again for not providing you with weekly update #4, but again I didn't have the time to write one, so this post is going to sum up everything that happened since my last update.<br><br>Let's have a look at my previous TODO list:<br><br><strong>Documentation</strong><br><br>Even though my TODO list entry contained a more detailed entry I have updated the UpdateManager documentation as a whole, leaving only a few blank spots right now.<br><br><strong>Ubuntu distribution specific code</strong><br><br>I implemented changelog fetching for Ubuntu, which works just as fine as its Debian counterpart now.<br><br><strong>More unit tests</strong><br><br>There are plenty of unit tests now, but not everything is being tested yet. I am especially proud of my Python interface validation code, that is being used in unit tests to check if handlers implement an interface correctly.<br><br><strong>Update list downloading</strong><br><br>Checking for updates is what caused me major trouble in the past few days. Basically I had all the code ready, but for some reason the UI froze, with no apparent reason.<br>However, today I was able to finally identify and fix the problem. As I expected my code was just fine, but python-apt was messing up. I am going to discuss the exact problem and its solution later on, but first: a screenshot. :-)<br></p><p style="text-align: center;"><a href="http://blog.peijnik.at/wp-content/uploads/2009/07/Screenshot-Checking-for-updates.png"><img alt="Update Manager update check" class="aligncenter size-thumbnail wp-image-151" height="150" src="http://blog.peijnik.at/wp-content/uploads/2009/07/Screenshot-Checking-for-updates-150x150.png" title="Update Manager update check" width="150"></a></p><br><br>Note: As you probably noticed I replaced the default progressbar with a pulsating one, because we cannot get exact information on how many items/bytes to fetch and would likely get a progress bar moving backwards, which isn't beautiful.<br><br><strong>Further changes</strong><br><br>The TODO list was rather short and I did a lot of other work, which I want to elaborate on.<br><br><strong>Dynamic selection of frontend, backend and distribution specific modules</strong><br><br>Even though this is probably not of any interest to John Doe, it helps a great deal when debugging code as all three components can be selected via separate command line switches now.<br>Additionally some magic has been put in place that automatically detects the system's distribution and loads the corresponding distribution specific module. This is done via lsb_release and the newly introduced code in UpdateManager.Util.lsb.<br><br><strong>Pylint cleanup</strong><br><br>Just out of curiosity I decided to start a pylint run on the codebase and quite a few problems were detected, which I then fixed. To be honest though I added quite some code afterwards that probably needs pylint checking and fixes again.<br><br><strong>update-manager IPC</strong><br><br>My original plan and IPC design involved using callback functions and passing them between the different modules. Even though this worked out fine I had the feeling this wasn't clean enough and decided to ditch this approach and replace it with handler classes.<br>The handler base classes now provide an interface of methods that are called on certain events and their implementations act accordingly. The main benefit was that I could easily drop a lot of enums and rather have different methods handling different events.<br><br><strong>Gtk, threads and python-apt</strong><br><br>With the new IPC approach it became easier to use threads that do the actual work in the background, which I had implemented in next to no time, but a few problems showed up.<br>Whilst cache reloading from within a thread worked just fine checking for updates did not, and until today I didn't know why. I spent a good amount of time debugging this issue, even using python profiling, but nothing obvious showed up. The background process was running, whilst the UI froze.<br>Today I finally found the root of the problem: python-apt. Even though I assumed that the python-apt worker threads must be stealing CPU time from the thread running gtk.main I wasn't sure how this could be happening, having two completely independent threads.<br><br>Now, the cause of all this mess was that Python has a global threading lock and it seems as if this one is *LOCKED* when running C-code, such as the one python-apt comes with. The solution lies in calling Py_BEGIN_THREADS_ALLOW and Py_END_THREADS_ALLOW from within the C code, to release the global lock and let the Python interpreter do some work every now and then.<br><br>As with the python-apt acquire code I was able to allow other threads to work as soon as the fetching code starts working and only disallow threads when actually modifying Python objects or calling methods and/or functions. Surprisingly python-apt already made use of this in its cache loading code, but not the fetch progress code.<br>Fixing this problem took me less than half an hour and you probably can't believe how glad I was to finally get things working again.<br><br><strong>UI updates &amp; other changes<br></strong><br><br>Some details in the UI were anything but optimal, like horizontal scrollbars in a few places, which I removed. Additionally I saw the need to move some code out of the Gtk frontend's __init__.py file and to a separate ui.py file.<br>A full list of all changes I made is available from the bzr changelog at <a href="http://bzr.debian.org/loggerhead/update-manager/devel/gsoc09/changes" title="update-manager changes @bzr.debian.org">bzr.debian.org</a>.<br><br><strong>A few more screenshots</strong><br><br>Finally, I would like to provide you with two more screenshots (don't worry about my system being insecure because of not applied updates - this is a testing machine that is  not up-to-date on purpose):<br><br><a href="http://blog.peijnik.at/wp-content/uploads/2009/07/Screenshot-Update-Manager-1.png"><img alt="Update Manager main screen" class="size-thumbnail wp-image-149 alignnone" height="150" src="http://blog.peijnik.at/wp-content/uploads/2009/07/Screenshot-Update-Manager-1-150x150.png" title="Update Manager main screen" width="150"></a><br><br><a href="http://blog.peijnik.at/wp-content/uploads/2009/07/Screenshot-Update-Manager.png"><img alt="Update Manager main screen with details &amp; changelog" class="size-thumbnail wp-image-150 alignnone" height="150" src="http://blog.peijnik.at/wp-content/uploads/2009/07/Screenshot-Update-Manager-150x150.png" title="Update Manager main screen with details &amp; changelog" width="150"></a><br><br><strong>TODO list</strong><br><br>My TODO list for next week:<br><ul><br><li>Downloading and installing of updates</li><br><li>Checking that everything is documented</li><br><li>Even more unit tests</li><br><li>Pylint checking</li><br><li>If time permits and everything else works correctly: working on an aptdaemon backend</li><br></ul><p>
        <a href="posts/200907update-manager-weekly-update-5.html#disqus_thread" data-disqus-identifier="cache/posts/200907update-manager-weekly-update-5.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="posts/200906python-interface-validation.html">Python interface validation</a></h1>
            <div class="meta" style="background-color: rgb(234, 234, 234); ">                    
                <span class="authordate">
                    Posted: 2009-06-22 22:30
                </span>
                <br><span class="tags">Tags: 
                            <a class="tag" href="categories/gsoc.html"><span class="badge badge-info">gsoc</span></a>
                            <a class="tag" href="categories/python.html"><span class="badge badge-info">python</span></a>
                            <a class="tag" href="categories/debian.html"><span class="badge badge-info">Debian</span></a>
                            <a class="tag" href="categories/update-manager.html"><span class="badge badge-info">update-manager</span></a>
                            <a class="tag" href="categories/free-software.html"><span class="badge badge-info">free software</span></a>
                </span>
            </div>
        <p>When I started working on update-manager I thought using zope.interface for my interfaces was a good idea, but soon realized that it lacked a way of actually validating a given interface against an implementation. The only thing it did was checking whether the implementation defined that it implements the interface.<br><br>Now, whilst writing some unit tests for update-manager I came up with a simple way of doing "real" validation, and I would like to share that Python code with you.<br><br>Firstly, I'd like to give you an overview of which checks my code carries out:<br></p><ul><br><li>Mandatory method (raises NotImplementedError in interface definition) is not implemented (also raises NotImplementedError in implementation)</li><br><li>Optional or mandatory method is of correct type (static method versus instance method)</li><br><li>Optional or mandatory method has a different signature (argument count is different)</li><br></ul><br>I consider at least the first and last check viable for validation of an interface against its implementation. The second check I listed is not that useful, and may produce false positives when someone uses certain decorators, I did not carry out any tests on that myself though.<br><br>The code can be found in update-manager's repository (<a href="http://bzr.debian.org/loggerhead/update-manager/devel/gsoc09/annotate/head:/tests/_helpers.py?" title="tests/_helpers.py @bzr.debian.org - update-manager gsoc09 repository">link</a>) and (for now) is licensed under the GPLv2 or later. I am willing to distribute this code as a separate Python module (maybe under a more permissive license like the LGPL) if enough (let's say at least two) people are interested in it, so please let me know if you like it.<br><br>Apart from the code itself the unit tests in the file linked above should explain how this beast exactly works.<br><br>Happy hacking!
            
    <p>
        <a href="posts/200906python-interface-validation.html#disqus_thread" data-disqus-identifier="cache/posts/200906python-interface-validation.html">Comments</a>

        </p></div>
    
<div>
<ul class="pager"><li class="previous">
        <a href="index.html">← Newer posts</a>
    </li>
    <li class="next">
        <a href="index-2.html">Older posts →</a>
    </li>
</ul></div>

    
       <script type="text/javascript">var disqus_shortname="speijnikblog";(function(){var a=document.createElement("script");a.async=true;a.type="text/javascript";a.src="http://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)}());</script></div>
        <div id="sidebar">
            <!--Sidebar content-->
            <h1 id="blog-title">
                <a href="." title="Stephan's blog">Stephan's blog</a>
            </h1>
            
            
            <ul class="unstyled"><li>
            
    <!-- Social buttons -->
    <div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
    <a class="addthis_button_more">Share</a>
    <ul><li><a class="addthis_button_facebook"></a>
    </li><li><a class="addthis_button_google_plusone_share"></a>
    </li><li><a class="addthis_button_linkedin"></a>
    </li><li><a class="addthis_button_twitter"></a>
    </li></ul></div>
    <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script><!-- End of social buttons --></li><li><a href="archive.html">Archives</a>
            </li><li><a href="categories/index.html">Tags</a>
            </li><li><a href="rss.xml">RSS</a>

            </li><li>
            </li></ul></div>
        <div id="footer">
            Contents © 2013         <a href="mailto:stephan@peijnik.at">Stephan Peijnik</a> - Powered by         <a href="http://nikola.ralsina.com.ar">Nikola</a>
        </div>
    </div>
    
</body></html>